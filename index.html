<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speaking Check App</title>
    <!-- Tailwind CSSã®èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwindã®è¨­å®šï¼š Interãƒ•ã‚©ãƒ³ãƒˆã¨ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ã‚’ä½¿ç”¨
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#4F46E5', // Indigo
                        'danger-red': '#EF4444', // Red
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    <style>
        /* Interãƒ•ã‚©ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        /* ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .microphone-btn {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .microphone-btn:active {
            transform: scale(0.95);
        }
        
        /* éŒ²éŸ³ä¸­ã®ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .recording-pulse {
            animation: pulse-red 1.5s infinite;
        }
        
        @keyframes pulse-red {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            50% {
                box-shadow: 0 0 0 30px rgba(239, 68, 68, 0);
            }
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4 font-sans">

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="w-full max-w-lg bg-white rounded-3xl shadow-2xl p-6 md:p-10 border-4 border-primary-blue">
        
        <!-- ã‚¿ã‚¤ãƒˆãƒ«ã‚’Speech To Textã«å¤‰æ›´ -->
        <h1 class="text-3xl md:text-4xl font-bold text-center text-primary-blue mb-6">
            <span role="img" aria-label="speech icon">ğŸ—£ï¸</span>
            Speech To Text Check
            <span role="img" aria-label="chat icon">ğŸ’¬</span>
        </h1>

        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
        <div id="status-display" class="bg-primary-blue/10 p-4 rounded-xl mb-8 text-center text-lg font-semibold text-primary-blue h-20 flex items-center justify-center">
            <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿ƒã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ -->
            <p id="status-text">ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦è‹±èªã‚’è©±ã—ã¦ãã ã•ã„ã€‚</p>
        </div>

        <!-- èªè­˜ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <!-- å¢ƒç•Œç·šã‚’ã‚·ãƒ³ãƒ—ãƒ«ã« -->
        <div class="bg-white border-2 border-gray-300 p-4 rounded-xl shadow-inner min-h-[100px] mb-8">
            <h2 class="text-xl font-bold text-gray-700 mb-2">What You Saidï¼ˆã‚ãªãŸãŒè¨€ã£ãŸã“ã¨ï¼‰ï¼š</h2>
            <p id="result-text" class="text-2xl text-gray-800 font-extrabold break-words">---</p>
        </div>
        
        <!-- æ¡ç‚¹çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ (#score-area) ã¯å‰Šé™¤ -->

        <!-- ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div class="flex flex-col items-center justify-center">
            <button id="microphone-button" class="microphone-btn 
                w-32 h-32 rounded-full 
                bg-primary-blue text-white 
                shadow-xl hover:shadow-2xl 
                flex items-center justify-center 
                focus:outline-none" 
                aria-label="Start/Stop Recording">
                
                <!-- ãƒã‚¤ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ (Lucide iconé¢¨ã®SVG) -->
                <svg id="mic-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-12 h-12">
                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="22"></line>
                </svg>
            </button>
            <!-- éŒ²éŸ³æŒ‡ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
            <p id="mic-instruction" class="mt-4 text-gray-600 font-medium">Tap and speak!</p>
        </div>
        
        <!-- ä»¥å‰ã®è­¦å‘Šãƒœãƒƒã‚¯ã‚¹ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸ -->

    </div>

    <script>
        // DOMè¦ç´ ã®å–å¾—
        const statusText = document.getElementById('status-text');
        const resultText = document.getElementById('result-text');
        const micButton = document.getElementById('microphone-button');
        const micIcon = document.getElementById('mic-icon');
        const micInstruction = document.getElementById('mic-instruction');
        const warningText = document.getElementById('warning-text'); // warningTextå¤‰æ•°ã¯DOMã‹ã‚‰å‰Šé™¤ã•ã‚ŒãŸãŒã€ã“ã“ã§ã¯æ®‹ã—ã¦ãŠã
        
        // æ¡ç‚¹æ©Ÿèƒ½ç”¨ã®DOMè¦ç´ ã¯ã™ã¹ã¦å‰Šé™¤

        // Web Speech APIã®äº’æ›æ€§ã‚’ç¢ºèª
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        
        let recognition = null;
        let isRecording = false;

        // AIæ¡ç‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨JSONã‚¹ã‚­ãƒ¼ãƒã¯ã™ã¹ã¦å‰Šé™¤

        /**
         * éŸ³å£°èªè­˜æ©Ÿèƒ½ã®åˆæœŸåŒ–ã¨ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
         */
        function initRecognition() {
            // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®š
            statusText.textContent = 'ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦è‹±èªã‚’è©±ã—ã¦ãã ã•ã„ã€‚';
            resultText.textContent = '---';
            
            if (!SpeechRecognition) {
                // Speech RecognitionãŒåˆ©ç”¨ä¸å¯ã®å ´åˆã®å‡¦ç†
                // è­¦å‘Šãƒœãƒƒã‚¯ã‚¹ã¯å‰Šé™¤ã—ãŸãŒã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯statusTextã«å‡ºã™
                statusText.textContent = 'âŒ éŸ³å£°èªè­˜ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚Chromeã¾ãŸã¯Edgeã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚';
                micButton.disabled = true;
                micButton.classList.add('opacity-50', 'cursor-not-allowed');
                return;
            }

            recognition = new SpeechRecognition();
            
            // è‹±ä¼šè©±ç·´ç¿’ã®ãŸã‚ã€è¨€èªã‚’è‹±èªï¼ˆã‚¢ãƒ¡ãƒªã‚«ï¼‰ã«è¨­å®š
            recognition.lang = 'en-US'; 
            recognition.interimResults = false; 
            recognition.continuous = false; // ä¸€å›ç™ºè©±ã”ã¨ã«åœæ­¢

            // **ãƒã‚¤ã‚¯è¨±å¯ã‚’äº‹å‰ã«ç¢ºèªã™ã‚‹é–¢æ•°**
            const startRecording = async () => {
                if (isRecording) {
                    recognition.stop();
                    return;
                }

                try {
                    // ãƒã‚¤ã‚¯ã®è¨±å¯ã‚’æ˜ç¤ºçš„ã«è¦æ±‚ã—ã€è¨±å¯ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’å¼·åˆ¶çš„ã«è¡¨ç¤º
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    stream.getTracks().forEach(track => track.stop()); // ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯ã™ãã«åœæ­¢

                    // éŒ²éŸ³é–‹å§‹ã®UIå¤‰æ›´ã¨Web Speech APIã®é–‹å§‹
                    isRecording = true;
                    micButton.classList.add('bg-danger-red', 'recording-pulse');
                    micButton.classList.remove('bg-primary-blue');
                    micIcon.style.stroke = 'white';
                    statusText.textContent = 'ğŸ‘‚ èã„ã¦ã„ã¾ã™... ä»Šè©±ã—ã¦ãã ã•ã„ï¼';
                    micInstruction.textContent = 'ã‚¿ãƒƒãƒ—ã—ã¦çµ‚äº†';
                    resultText.textContent = ''; 
                    
                    recognition.start();

                } catch (e) {
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ‹’å¦ã—ãŸå ´åˆ
                    console.error("Microphone access failed:", e);
                    isRecording = false; 
                    micButton.classList.remove('bg-danger-red', 'recording-pulse');
                    micButton.classList.add('bg-primary-blue');
                    micIcon.style.stroke = 'white';
                    statusText.textContent = 'âŒ ãƒã‚¤ã‚¯ã®åˆ©ç”¨ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'; 
                }
            };
            
            // éŒ²éŸ³é–‹å§‹æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ 
            recognition.onstart = () => {
                isRecording = true;
            };

            // èªè­˜çµæœãŒå‡ºãŸæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ 
            recognition.onresult = async (event) => {
                let transcript = event.results[0][0].transcript;
                
                // èªè­˜çµæœã®æ•´å½¢
                if (!/[.!?]$/.test(transcript.trim())) {
                    transcript = transcript.trim() + '.';
                } else {
                    transcript = transcript.trim();
                }

                resultText.textContent = transcript;
                statusText.textContent = 'âœ… èªè­˜ã—ã¾ã—ãŸï¼';
                // AIæ¡ç‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯ã“ã“ã‹ã‚‰å®Œå…¨ã«å‰Šé™¤
            };

            // éŒ²éŸ³çµ‚äº†æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ 
            recognition.onend = () => {
                isRecording = false;
                // UIã‚’ãƒªã‚»ãƒƒãƒˆ
                micButton.classList.remove('bg-danger-red', 'recording-pulse');
                micButton.classList.add('bg-primary-blue');
                micIcon.style.stroke = 'white';
                micInstruction.textContent = 'Tap and speak!'; 
                
                if (resultText.textContent === "" || resultText.textContent === "---") {
                    statusText.textContent = 'èã“ãˆã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦è©±ã—ã¦ã¿ã‚ˆã†ï¼'; 
                    resultText.textContent = '---';
                }
            };

            // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ 
            recognition.onerror = (event) => {
                console.error('Speech Recognition Error:', event.error);
                isRecording = false;
                micButton.classList.remove('bg-danger-red', 'recording-pulse');
                micButton.classList.add('bg-primary-blue');
                micIcon.style.stroke = 'white';
                micInstruction.textContent = 'Tap and speak!'; 
                
                let errorMessage = 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
                if (event.error === 'not-allowed' || event.error === 'permission-denied') {
                    errorMessage = 'âŒ ãƒã‚¤ã‚¯ã®åˆ©ç”¨ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'; 
                } else if (event.error === 'no-speech') {
                    errorMessage = 'éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã¯ã£ãã‚Šè©±ã—ã¦ãã ã•ã„ã€‚'; 
                }
                statusText.textContent = errorMessage;
            };

            // ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
            micButton.addEventListener('click', startRecording);
        }
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
        window.onload = initRecognition;
    </script>
</body>
</html>
